use io;
use _uv;

main argv {
  var loop = _uv.default_loop();
  var srv = loop.tcp();
  srv.bind(43456).listen(fn { |c|
    io.print(str("connection: ", c));
    c.write("Hello, World");
    c.close();
  });

  #
  # testing for GC bugs: the loop should have
  # a ref to the server object.
  #
  srv = nil;

  loop.run();
}

